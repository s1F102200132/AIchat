<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

   {% load static %}
   <link rel="stylesheet" type="text/css" href="{% static 'blog/style.css' %}">

   <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</head>
<body>
    <h1 class="lang" data-ja="AIチャットボット" data-en="AI Chatbot">AIチャットボット</h1>

    <button onclick="setLanguage('ja')" class="lang-btn">日本語</button>
    <button onclick="setLanguage('en')" class="lang-btn">English</button>


    <div>
        <div id="chatbot">
            <p class="botText lang" data-ja="こんにちは！" data-en="Hi there!"><span>こんにちは！</span></p>
        </div>
        <div id="userInput">
            <input type="text" id="textInput" name="userMessage" placeholder="メッセージを入力してください..." data-placeholder-ja="メッセージを入力してください..." data-placeholder-en="Type your message..." />
            <input type="submit" value="送信" id="buttonInput" class="lang" data-ja="送信" data-en="Send" />
        </div>
    </div>


    <script>

        function getUserResponse(){
            var userText = $('#textInput').val().trim();
            if (userText === "") return;  // 空文字なら送信しない
        
            var userHTML = "<p class='userText'>User: <span>"+userText+"</span></p>";
            $('#textInput').val("");
            $('#chatbot').append(userHTML);
        
            $.get('/blog/getResponse',{userMessage:userText}).done(function(data){
                var returnedMessage = "<p class='botText'>Chatbot: <span>"+ data + "</span></p>";
                $('#chatbot').append(returnedMessage);
        
                // 👇 自動スクロールも追加（次項）
                $('#chatbot').scrollTop($('#chatbot')[0].scrollHeight);
            });
        }
        


      $('#buttonInput').click(function(){
        getUserResponse();

      })

      function setLanguage(lang) {
        document.querySelectorAll('.lang').forEach(el => {
          const text = el.getAttribute(`data-${lang}`);
          if (text !== null) {
            if (el.tagName.toLowerCase() === 'input') {
              el.value = text;
            } else {
              el.innerHTML = text;
            }
          }
        });
    
        // プレースホルダも変える
        const input = document.getElementById('textInput');
        if (input) {
          input.placeholder = input.getAttribute(`data-placeholder-${lang}`); 
        }
      }
    
      // 初期は日本語に設定
      window.onload = function() {
        setLanguage('ja');
      }
        
    </script>

</body>
</html>